<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Connection Test</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f0f0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #4A90E2;
        }

        .header h1 {
            color: #4A90E2;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
        }

        .test-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .btn {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 5px;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background: #357abd;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .loading {
            color: #6c757d;
            font-style: italic;
        }

        .config-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .config-item {
            margin-bottom: 8px;
        }

        .config-label {
            font-weight: bold;
            color: #495057;
            width: 120px;
            display: inline-block;
        }

        .config-value {
            color: #007bff;
            font-family: 'Courier New', monospace;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #4A90E2;
        }

        .stat-label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Firebase Connection Test</h1>
            <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase Database</p>
        </div>

        <!-- Firebase Config Display -->
        <div class="test-section">
            <h3>üìä Firebase Configuration</h3>
            <div id="configDisplay" class="config-display">
                <div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î Firebase config...</div>
            </div>
        </div>

        <!-- Connection Test -->
        <div class="test-section">
            <h3>üîç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</h3>
            <button class="btn" onclick="testConnection()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</button>
            <div id="connectionResult" class="result" style="display: none;"></div>
        </div>

        <!-- Database Stats -->
        <div class="test-section">
            <h3>üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Database</h3>
            <button class="btn" onclick="getDatabaseStats()">‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <div id="statsResult" class="result" style="display: none;"></div>
        </div>

        <!-- Data Samples -->
        <div class="test-section">
            <h3>üìã ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
            <button class="btn" onclick="getEmployeeSample()">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (5 ‡∏Ñ‡∏ô)</button>
            <button class="btn" onclick="getToolsSample()">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ (5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</button>
            <button class="btn" onclick="getRequestsSample()">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠ (5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</button>
            <div id="sampleResult" class="result" style="display: none;"></div>
        </div>

        <!-- Create Test Data -->
        <div class="test-section">
            <h3>‚úèÔ∏è ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
            <button class="btn" onclick="createSampleRequest()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
            <div id="createResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="firebase-real-config.js"></script>
    
    <script type="module">
        // ‡∏£‡∏≠‡πÉ‡∏´‡πâ Firebase ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
        window.addEventListener('load', async () => {
            await waitForFirebase();
            displayFirebaseConfig();
        });

        function waitForFirebase() {
            return new Promise((resolve) => {
                const checkFirebase = () => {
                    if (window.firebase) {
                        resolve();
                    } else {
                        setTimeout(checkFirebase, 100);
                    }
                };
                checkFirebase();
            });
        }

        function displayFirebaseConfig() {
            if (window.firebaseApp && window.firebaseApp.options) {
                const config = window.firebaseApp.options;
                document.getElementById('configDisplay').innerHTML = `
                    <div class="config-item">
                        <span class="config-label">Project ID:</span>
                        <span class="config-value">${config.projectId}</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Auth Domain:</span>
                        <span class="config-value">${config.authDomain}</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Storage Bucket:</span>
                        <span class="config-value">${config.storageBucket}</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">API Key:</span>
                        <span class="config-value">${config.apiKey.substring(0, 10)}...</span>
                    </div>
                `;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
        window.testConnection = async function() {
            const resultDiv = document.getElementById('connectionResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...';

            try {
                const tests = await window.firebase.testConnection();
                
                let resultText = 'üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠:\n\n';
                tests.forEach(test => {
                    resultText += `${test.status} ${test.collection}: ${test.message}\n`;
                });

                resultDiv.className = 'result success';
                resultDiv.textContent = resultText;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:\n${error.message}`;
            }
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Database
        window.getDatabaseStats = async function() {
            const resultDiv = document.getElementById('statsResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';

            try {
                const stats = await window.firebase.getDatabaseStats();
                
                // ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î
                const statsGrid = document.createElement('div');
                statsGrid.className = 'stats-grid';
                
                Object.entries(stats).forEach(([key, count]) => {
                    const card = document.createElement('div');
                    card.className = 'stat-card';
                    card.innerHTML = `
                        <div class="stat-number">${count}</div>
                        <div class="stat-label">${key}</div>
                    `;
                    statsGrid.appendChild(card);
                });

                resultDiv.className = 'result success';
                resultDiv.innerHTML = '';
                resultDiv.appendChild(statsGrid);
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:\n${error.message}`;
            }
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
        window.getEmployeeSample = async function() {
            const resultDiv = document.getElementById('sampleResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô...';

            try {
                const employees = await window.firebase.getEmployees();
                const sample = employees.slice(0, 5);
                
                let resultText = `üë• ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (${sample.length} ‡∏à‡∏≤‡∏Å ${employees.length} ‡∏Ñ‡∏ô):\n\n`;
                sample.forEach((emp, index) => {
                    resultText += `${index + 1}. ${emp.employee_id} - ${emp.full_name}\n`;
                    resultText += `   ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô: ${emp.department || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}\n`;
                    resultText += `   ‡πÅ‡∏ú‡∏ô‡∏Å: ${emp.section || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}\n\n`;
                });

                resultDiv.className = 'result success';
                resultDiv.textContent = resultText;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:\n${error.message}`;
            }
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠
        window.getToolsSample = async function() {
            const resultDiv = document.getElementById('sampleResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠...';

            try {
                const tools = await window.firebase.getTools();
                const sample = tools.slice(0, 5);
                
                let resultText = `üîß ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ (${sample.length} ‡∏à‡∏≤‡∏Å ${tools.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£):\n\n`;
                sample.forEach((tool, index) => {
                    resultText += `${index + 1}. ${tool.tool_name}\n`;
                    resultText += `   ‡∏£‡∏´‡∏±‡∏™: ${tool.old_code || tool.serial_no || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}\n`;
                    resultText += `   ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${tool.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}\n\n`;
                });

                resultDiv.className = 'result success';
                resultDiv.textContent = resultText;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:\n${error.message}`;
            }
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠
        window.getRequestsSample = async function() {
            const resultDiv = document.getElementById('sampleResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠...';

            try {
                const requests = await window.firebase.getToolRequests();
                const sample = requests.slice(0, 5);
                
                let resultText = `üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠ (${sample.length} ‡∏à‡∏≤‡∏Å ${requests.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£):\n\n`;
                sample.forEach((req, index) => {
                    const date = req.created_at ? 
                        (req.created_at.toDate ? req.created_at.toDate() : new Date(req.created_at)) : 
                        new Date();
                    
                    resultText += `${index + 1}. ${req.id || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ ID'}\n`;
                    resultText += `   ‡∏ú‡∏π‡πâ‡∏Ç‡∏≠: ${req.employee_name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'} (${req.employee_id || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'})\n`;
                    resultText += `   ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${date.toLocaleDateString('th-TH')}\n`;
                    resultText += `   ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${req.status || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}\n\n`;
                });

                resultDiv.className = 'result success';
                resultDiv.textContent = resultText;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:\n${error.message}`;
            }
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö
        window.createSampleRequest = async function() {
            const resultDiv = document.getElementById('createResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö...';

            try {
                const sampleRequest = {
                    employee_id: '100013',
                    employee_name: '‡∏ä‡∏±‡∏¢‡∏ä‡∏≤‡∏ç ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå',
                    department: '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£',
                    section: 'Sukhumvit 29 Hotel (HT-SKV29)',
                    project: 'Sukhumvit 29 Hotel (HT-SKV29)',
                    requested_tools: [
                        {
                            tool_id: 'T001',
                            tool_name: '‡∏™‡∏ß‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ DEWALT',
                            tool_code: 'T001',
                            quantity: 1,
                            note: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö'
                        }
                    ],
                    status: 'pending',
                    created_at: new Date().toISOString()
                };

                const requestId = await window.firebase.addToolRequest(sampleRequest);
                
                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\nRequest ID: ${requestId}\n‡∏ú‡∏π‡πâ‡∏Ç‡∏≠: ${sampleRequest.employee_name}\n‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠: ${sampleRequest.requested_tools[0].tool_name}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:\n${error.message}`;
            }
        };

    </script>
</body>
</html>