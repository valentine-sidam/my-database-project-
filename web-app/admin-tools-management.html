<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tools Track - Admin Management System</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #4682B4 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: #f0f8ff;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            max-width: 1400px;
            margin: 0 auto;
            border: 2px solid #4682B4;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #4682B4;
        }

        .header h1 {
            font-size: 32px;
            color: #2c5aa0;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .header p {
            color: #4682B4;
            font-size: 16px;
            font-weight: 500;
        }

        .admin-info {
            background: #e6f3ff;
            border: 2px solid #4682B4;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-details h3 {
            color: #2c5aa0;
            margin-bottom: 5px;
        }

        .admin-details p {
            color: #4682B4;
            font-size: 14px;
        }

        .status-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .status-card {
            background: white;
            border: 2px solid #4682B4;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .status-card h4 {
            color: #2c5aa0;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .status-card p {
            color: #4682B4;
            font-size: 12px;
        }

        .filter-section {
            background: #e6f3ff;
            border: 2px solid #4682B4;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .filter-title {
            color: #2c5aa0;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .filter-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 20px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            color: #2c5aa0;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .filter-group select, .filter-group input {
            padding: 12px;
            border: 2px solid #4682B4;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: #2c5aa0;
        }

        .filter-group select:focus, .filter-group input:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 5px rgba(44, 90, 160, 0.3);
        }

        .btn-filter {
            background: #4682B4;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            height: fit-content;
        }

        .btn-filter:hover {
            background: #2c5aa0;
        }

        .requests-container {
            background: white;
            border: 2px solid #4682B4;
            border-radius: 15px;
            overflow: hidden;
        }

        .requests-header {
            background: #4682B4;
            color: white;
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }

        .requests-content {
            max-height: 600px;
            overflow-y: auto;
        }

        .request-item {
            border-bottom: 2px solid #e6f3ff;
            padding: 25px;
            transition: background-color 0.3s;
        }

        .request-item:hover {
            background: #f0f8ff;
        }

        .request-item:last-child {
            border-bottom: none;
        }

        .request-header {
            display: grid;
            grid-template-columns: 200px 200px 200px 1fr 150px;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 10px;
            border: 1px solid #4682B4;
        }

        .request-id {
            font-weight: bold;
            color: #2c5aa0;
            font-size: 16px;
        }

        .employee-info {
            color: #4682B4;
            font-size: 14px;
        }

        .project-info {
            color: #4682B4;
            font-size: 14px;
        }

        .request-date {
            color: #666;
            font-size: 12px;
        }

        .status-dropdown {
            padding: 8px 12px;
            border: 2px solid #4682B4;
            border-radius: 5px;
            background: white;
            color: #2c5aa0;
            font-weight: bold;
            cursor: pointer;
        }

        .status-pending { background: #fff3cd; }
        .status-approved { background: #d4edda; }
        .status-completed { background: #cce5ff; }
        .status-rejected { background: #f8d7da; }

        .tools-management {
            margin-top: 20px;
            background: #f8f9fa;
            border: 2px solid #4682B4;
            border-radius: 10px;
            padding: 20px;
        }

        .tools-title {
            color: #2c5aa0;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: 50px 300px 100px 150px 100px 80px 100px;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }

        .tools-header {
            background: #4682B4;
            color: white;
            padding: 10px 5px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
            border-radius: 5px;
        }

        .tool-row {
            background: white;
            border: 1px solid #4682B4;
            border-radius: 5px;
            padding: 10px 5px;
            text-align: center;
            font-size: 13px;
            color: #2c5aa0;
        }

        .tool-row select, .tool-row input {
            width: 100%;
            padding: 5px;
            border: 1px solid #4682B4;
            border-radius: 3px;
            font-size: 12px;
        }

        .btn-group {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .btn-add, .btn-delete {
            width: 25px;
            height: 25px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-add {
            background: #28a745;
            color: white;
        }

        .btn-add:hover {
            background: #218838;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .btn-save, .btn-cancel {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-save {
            background: #28a745;
            color: white;
        }

        .btn-save:hover {
            background: #218838;
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
        }

        .btn-cancel:hover {
            background: #545b62;
        }

        .no-requests {
            text-align: center;
            padding: 50px;
            color: #4682B4;
            font-style: italic;
            font-size: 18px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }

            .filter-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .request-header {
                grid-template-columns: 1fr;
                gap: 10px;
                text-align: center;
            }

            .tools-grid {
                grid-template-columns: 1fr;
                gap: 5px;
            }

            .status-summary {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ†Ô∏è Tools Track Admin</h1>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£</p>
        </div>

        <!-- Admin Info -->
        <div class="admin-info">
            <div class="admin-details">
                <h3>üë©‚Äçüíº ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£</h3>
                <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡πÉ‡∏à‡∏î‡∏µ | <strong>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</strong> ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠</p>
                <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> <span id="currentDate"></span> | <strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> <span id="currentTime"></span></p>
            </div>
            <div class="status-summary">
                <div class="status-card">
                    <h4 id="pendingCount">5</h4>
                    <p>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                </div>
                <div class="status-card">
                    <h4 id="approvedCount">3</h4>
                    <p>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</p>
                </div>
                <div class="status-card">
                    <h4 id="completedCount">8</h4>
                    <p>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</p>
                </div>
                <div class="status-card">
                    <h4 id="rejectedCount">1</h4>
                    <p>‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</p>
                </div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-title">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠</div>
            <div class="filter-row">
                <div class="filter-group">
                    <label>User (‡∏ú‡∏π‡πâ‡∏Ç‡∏≠):</label>
                    <select id="userFilter">
                        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="100007">100007 - ‡∏Å‡∏°‡∏•‡∏•‡∏≤‡∏® ‡∏ß‡∏¥‡∏ä‡∏±‡∏¢‡πÇ‡∏¢</option>
                        <option value="100013">100013 - ‡∏ä‡∏±‡∏¢‡∏ä‡∏≤‡∏ç ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</option>
                        <option value="100015">100015 - ‡∏õ‡∏¥‡∏¢‡∏∞ ‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡πÑ‡∏ï‡∏¢</option>
                        <option value="100020">100020 - ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ</option>
                        <option value="100025">100025 - ‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏™‡∏∏‡∏Ç‡πÉ‡∏à</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
                    <select id="statusFilter">
                        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="pending">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                        <option value="approved">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                        <option value="rejected">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
                    <input type="date" id="dateFilter">
                </div>
                <button class="btn-filter" onclick="filterRequests()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            </div>
        </div>

        <!-- Requests Container -->
        <div class="requests-container">
            <div class="requests-header">
                üìã ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </div>
            <div class="requests-content" id="requestsContent">
                <!-- ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
            </div>
        </div>
    </div>

    <script>
        // Mock Data ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
        let requestsData = [
            {
                id: "REQ001",
                employee_id: "100007",
                employee_name: "‡∏Å‡∏°‡∏•‡∏•‡∏≤‡∏® ‡∏ß‡∏¥‡∏ä‡∏±‡∏¢‡πÇ‡∏¢",
                project: "PRANNOK-TADMAI (DH2)",
                created_at: "2024-10-08",
                status: "pending",
                tools: [
                    { id: 1, tool_name: "‡∏™‡∏ß‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ DEWALT", serial_no: "DCD996B", old_code: "T001", quantity: 1, note: "‡∏á‡∏≤‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á" },
                    { id: 2, tool_name: "‡∏ö‡∏¥‡∏ï‡∏™‡∏ß‡πà‡∏≤‡∏ô Set 20 ‡∏ä‡∏¥‡πâ‡∏ô", serial_no: "DT7969", old_code: "T002", quantity: 1, note: "" }
                ]
            },
            {
                id: "REQ002",
                employee_id: "100013",
                employee_name: "‡∏ä‡∏±‡∏¢‡∏ä‡∏≤‡∏ç ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå",
                project: "PRANNOK-TADMAI (DH2)",
                created_at: "2024-10-09",
                status: "approved",
                tools: [
                    { id: 3, tool_name: "‡∏Å‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤", serial_no: "DW680K", old_code: "T003", quantity: 1, note: "‡∏á‡∏≤‡∏ô‡πÄ‡∏à‡∏≤‡∏∞‡πÑ‡∏°‡πâ" }
                ]
            },
            {
                id: "REQ003",
                employee_id: "100015",
                employee_name: "‡∏õ‡∏¥‡∏¢‡∏∞ ‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡πÑ‡∏ï‡∏¢",
                project: "PROJECT-A",
                created_at: "2024-10-07",
                status: "completed",
                tools: [
                    { id: 4, tool_name: "‡∏•‡∏π‡∏Å‡∏ö‡∏¥‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡πâ‡∏≤‡∏°", serial_no: "SB001", old_code: "T004", quantity: 2, note: "" },
                    { id: 5, tool_name: "‡∏Ñ‡πâ‡∏≠‡∏ô‡∏´‡∏á‡∏≠‡∏ô", serial_no: "HM001", old_code: "T005", quantity: 1, note: "‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö" }
                ]
            },
            {
                id: "REQ004",
                employee_id: "100020",
                employee_name: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ",
                project: "PROJECT-B",
                created_at: "2024-10-06",
                status: "rejected",
                tools: [
                    { id: 6, tool_name: "‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏¢‡∏ß‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", serial_no: "CS001", old_code: "T006", quantity: 1, note: "‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏î‡πÑ‡∏°‡πâ" }
                ]
            },
            {
                id: "REQ005",
                employee_id: "100007",
                employee_name: "‡∏Å‡∏°‡∏•‡∏•‡∏≤‡∏® ‡∏ß‡∏¥‡∏ä‡∏±‡∏¢‡πÇ‡∏¢",
                project: "PRANNOK-TADMAI (DH2)",
                created_at: "2024-10-10",
                status: "pending",
                tools: [
                    { id: 7, tool_name: "‡πÑ‡∏Ç‡∏Ñ‡∏ß‡∏á‡∏ä‡∏∏‡∏î", serial_no: "SD001", old_code: "T007", quantity: 1, note: "" }
                ]
            }
        ];

        const availableTools = [
            { tool_name: "‡∏™‡∏ß‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ DEWALT", serial_no: "DCD996B", old_code: "T001" },
            { tool_name: "‡∏ö‡∏¥‡∏ï‡∏™‡∏ß‡πà‡∏≤‡∏ô Set 20 ‡∏ä‡∏¥‡πâ‡∏ô", serial_no: "DT7969", old_code: "T002" },
            { tool_name: "‡∏Å‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤", serial_no: "DW680K", old_code: "T003" },
            { tool_name: "‡∏•‡∏π‡∏Å‡∏ö‡∏¥‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡πâ‡∏≤‡∏°", serial_no: "SB001", old_code: "T004" },
            { tool_name: "‡∏Ñ‡πâ‡∏≠‡∏ô‡∏´‡∏á‡∏≠‡∏ô", serial_no: "HM001", old_code: "T005" },
            { tool_name: "‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏¢‡∏ß‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", serial_no: "CS001", old_code: "T006" },
            { tool_name: "‡πÑ‡∏Ç‡∏Ñ‡∏ß‡∏á‡∏ä‡∏∏‡∏î", serial_no: "SD001", old_code: "T007" },
            { tool_name: "‡∏õ‡∏£‡∏∞‡πÅ‡∏à‡πÅ‡∏´‡∏ß‡∏ô", serial_no: "WR001", old_code: "T008" }
        ];

        let filteredRequests = [...requestsData];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            updateStatusSummary();
            displayRequests(requestsData);
            
            // Update time every second
            setInterval(updateDateTime, 1000);
        });

        function updateDateTime() {
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('th-TH');
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('th-TH');
        }

        function updateStatusSummary() {
            const pending = requestsData.filter(req => req.status === 'pending').length;
            const approved = requestsData.filter(req => req.status === 'approved').length;
            const completed = requestsData.filter(req => req.status === 'completed').length;
            const rejected = requestsData.filter(req => req.status === 'rejected').length;

            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('approvedCount').textContent = approved;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('rejectedCount').textContent = rejected;
        }

        function displayRequests(requests) {
            const container = document.getElementById('requestsContent');
            
            if (requests.length === 0) {
                container.innerHTML = `
                    <div class="no-requests">
                        üì≠ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                    </div>
                `;
                return;
            }

            container.innerHTML = requests.map(request => `
                <div class="request-item">
                    <div class="request-header">
                        <div class="request-id">üìã ${request.id}</div>
                        <div class="employee-info">
                            <strong>üë§ ${request.employee_name}</strong><br>
                            <small>‡∏£‡∏´‡∏±‡∏™: ${request.employee_id}</small>
                        </div>
                        <div class="project-info">
                            <strong>üìÅ ${request.project}</strong>
                        </div>
                        <div class="request-date">
                            üìÖ ${formatDate(request.created_at)}
                        </div>
                        <select class="status-dropdown status-${request.status}" onchange="changeStatus('${request.id}', this.value)">
                            <option value="pending" ${request.status === 'pending' ? 'selected' : ''}>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="approved" ${request.status === 'approved' ? 'selected' : ''}>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option>
                            <option value="completed" ${request.status === 'completed' ? 'selected' : ''}>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                            <option value="rejected" ${request.status === 'rejected' ? 'selected' : ''}>‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</option>
                        </select>
                    </div>
                    
                    <div class="tools-management">
                        <div class="tools-title">
                            üîß ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠
                            <button class="btn-add" onclick="addNewTool('${request.id}')" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠">+</button>
                        </div>
                        
                        <div class="tools-grid">
                            <div class="tools-header">No</div>
                            <div class="tools-header">Tool (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠)</div>
                            <div class="tools-header">Serial No.</div>
                            <div class="tools-header">Old Code</div>
                            <div class="tools-header">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</div>
                            <div class="tools-header">Note</div>
                            <div class="tools-header">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</div>
                        </div>
                        
                        <div id="tools-${request.id}">
                            ${request.tools.map((tool, index) => generateToolRow(request.id, tool, index + 1)).join('')}
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn-save" onclick="saveChanges('${request.id}')">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</button>
                            <button class="btn-cancel" onclick="cancelChanges('${request.id}')">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function generateToolRow(requestId, tool, index) {
            return `
                <div class="tool-row">${index}</div>
                <div class="tool-row">
                    <select onchange="updateToolInfo('${requestId}', ${tool.id}, this)">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠</option>
                        ${availableTools.map(t => `
                            <option value="${JSON.stringify(t).replace(/"/g, '&quot;')}" 
                                    ${t.tool_name === tool.tool_name ? 'selected' : ''}>
                                ${t.tool_name}
                            </option>
                        `).join('')}
                    </select>
                </div>
                <div class="tool-row">
                    <input type="text" value="${tool.serial_no}" id="serial-${requestId}-${tool.id}" readonly>
                </div>
                <div class="tool-row">
                    <input type="text" value="${tool.old_code}" id="code-${requestId}-${tool.id}" readonly>
                </div>
                <div class="tool-row">
                    <input type="number" value="${tool.quantity}" min="1" id="qty-${requestId}-${tool.id}">
                </div>
                <div class="tool-row">
                    <input type="text" value="${tool.note}" id="note-${requestId}-${tool.id}" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">
                </div>
                <div class="tool-row">
                    <button class="btn-delete" onclick="deleteTool('${requestId}', ${tool.id})" title="‡∏•‡∏ö">√ó</button>
                </div>
            `;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function changeStatus(requestId, newStatus) {
            const request = requestsData.find(req => req.id === requestId);
            if (request) {
                request.status = newStatus;
                updateStatusSummary();
                console.log(`‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠ ${requestId} ‡πÄ‡∏õ‡πá‡∏ô: ${newStatus}`);
                
                // Refresh display to update styling
                const currentFilter = getCurrentFilter();
                filterRequests();
            }
        }

        function updateToolInfo(requestId, toolId, selectElement) {
            if (selectElement.value) {
                const toolData = JSON.parse(selectElement.value);
                document.getElementById(`serial-${requestId}-${toolId}`).value = toolData.serial_no;
                document.getElementById(`code-${requestId}-${toolId}`).value = toolData.old_code;
                console.log(`üîß ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠: ${toolData.tool_name}`);
            }
        }

        function addNewTool(requestId) {
            const request = requestsData.find(req => req.id === requestId);
            if (request) {
                const newToolId = Date.now(); // Generate unique ID
                const newTool = {
                    id: newToolId,
                    tool_name: "",
                    serial_no: "",
                    old_code: "",
                    quantity: 1,
                    note: ""
                };
                
                request.tools.push(newTool);
                
                // Refresh the tools display for this request
                const toolsContainer = document.getElementById(`tools-${requestId}`);
                toolsContainer.innerHTML = request.tools.map((tool, index) => 
                    generateToolRow(requestId, tool, index + 1)
                ).join('');
                
                console.log(`‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠ ${requestId}`);
            }
        }

        function deleteTool(requestId, toolId) {
            const request = requestsData.find(req => req.id === requestId);
            if (request && request.tools.length > 1) {
                request.tools = request.tools.filter(tool => tool.id !== toolId);
                
                // Refresh the tools display for this request
                const toolsContainer = document.getElementById(`tools-${requestId}`);
                toolsContainer.innerHTML = request.tools.map((tool, index) => 
                    generateToolRow(requestId, tool, index + 1)
                ).join('');
                
                console.log(`‚ûñ ‡∏•‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏Ç‡∏≠ ${requestId}`);
            } else {
                alert('‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
            }
        }

        function saveChanges(requestId) {
            const request = requestsData.find(req => req.id === requestId);
            if (request) {
                // Update tool quantities and notes
                request.tools.forEach(tool => {
                    const qtyInput = document.getElementById(`qty-${requestId}-${tool.id}`);
                    const noteInput = document.getElementById(`note-${requestId}-${tool.id}`);
                    
                    if (qtyInput) tool.quantity = parseInt(qtyInput.value) || 1;
                    if (noteInput) tool.note = noteInput.value || '';
                });
                
                alert(`üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠ ${requestId} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`);
                console.log(`üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠ ${requestId}:`, request);
            }
        }

        function cancelChanges(requestId) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) {
                // Refresh the display to original state
                displayRequests(filteredRequests);
                console.log(`‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠ ${requestId}`);
            }
        }

        function filterRequests() {
            const userFilter = document.getElementById('userFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;

            filteredRequests = requestsData.filter(request => {
                const matchUser = !userFilter || request.employee_id === userFilter;
                const matchStatus = !statusFilter || request.status === statusFilter;
                const matchDate = !dateFilter || request.created_at === dateFilter;
                
                return matchUser && matchStatus && matchDate;
            });

            displayRequests(filteredRequests);
            console.log(`üîç ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡∏û‡∏ö ${filteredRequests.length} ‡∏Ñ‡∏≥‡∏Ç‡∏≠`);
        }

        function getCurrentFilter() {
            return {
                user: document.getElementById('userFilter').value,
                status: document.getElementById('statusFilter').value,
                date: document.getElementById('dateFilter').value
            };
        }
    </script>
</body>
</html>