<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Firebase Connection</title>
</head>
<body>
    <h1>üî• Test Firebase Connection</h1>
    <div id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
    <div id="employeeTest">
        <h2>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:</h2>
        <input type="text" id="empInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå 100007">
        <div id="empResult"></div>
    </div>
    <div id="toolTest">
        <h2>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠:</h2>
        <input type="text" id="toolInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå TTS">
        <div id="toolResult"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCkw5r3iAb8AKF_kE_GV2WlExcWYDOPJiM",
            authDomain: "my-database-project-343ae.firebaseapp.com",
            projectId: "my-database-project-343ae",
            storageBucket: "my-database-project-343ae.firebasestorage.app",
            messagingSenderId: "945297983068",
            appId: "1:945297983068:web:4d2ab8d26f10f6c9b8f21a"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let employees = [];
        let tools = [];

        async function testConnection() {
            try {
                // Test employees
                const empSnapshot = await getDocs(collection(db, 'employees'));
                empSnapshot.forEach(doc => {
                    const data = doc.data();
                    employees.push({
                        id: data.employee_id,
                        name: data.full_name,
                        dept: data.department,
                        section: data.section
                    });
                });

                // Test tools
                const toolSnapshot = await getDocs(collection(db, 'tools'));
                toolSnapshot.forEach(doc => {
                    const data = doc.data();
                    tools.push({
                        id: data.old_code || data.serial_no,
                        name: data.tool_name,
                        location: data.location
                    });
                });

                document.getElementById('status').innerHTML = `
                    ‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>
                    üë• ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ${employees.length} ‡∏Ñ‡∏ô<br>
                    üîß ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠: ${tools.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                `;

                setupTests();
            } catch (error) {
                document.getElementById('status').innerHTML = `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`;
            }
        }

        function setupTests() {
            // Employee test
            document.getElementById('empInput').addEventListener('input', function() {
                const value = this.value;
                const emp = employees.find(e => e.id === value);
                if (emp) {
                    document.getElementById('empResult').innerHTML = `
                        ‚úÖ ‡∏û‡∏ö: ${emp.name}<br>
                        üè¢ ‡∏´‡∏ô‡πà‡∏ß‡∏¢: ${emp.dept}<br>
                        üìç ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£: ${emp.section}
                    `;
                } else if (value) {
                    document.getElementById('empResult').innerHTML = '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô';
                } else {
                    document.getElementById('empResult').innerHTML = '';
                }
            });

            // Tool test
            document.getElementById('toolInput').addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const matchedTools = tools.filter(t => 
                    t.id.toLowerCase().includes(value) || 
                    t.name.toLowerCase().includes(value)
                ).slice(0, 5);

                if (matchedTools.length > 0) {
                    document.getElementById('toolResult').innerHTML = 
                        '‚úÖ ‡∏û‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠:<br>' + 
                        matchedTools.map(t => `${t.id} - ${t.name}`).join('<br>');
                } else if (value) {
                    document.getElementById('toolResult').innerHTML = '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠';
                } else {
                    document.getElementById('toolResult').innerHTML = '';
                }
            });
        }

        testConnection();
    </script>
</body>
</html>