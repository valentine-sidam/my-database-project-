<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tools Track - ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å (Hybrid)</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            max-width: 1000px;
            width: 100%;
            min-height: 600px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .header h1 {
            font-size: 28px;
            color: #333;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .connection-status {
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        .status-firebase {
            background: #d1ecf1;
            border: 2px solid #bee5eb;
            color: #0c5460;
        }

        .status-mock {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            color: #856404;
        }

        .status-error {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
        }

        .loading {
            background: #e2e3e5;
            border: 2px solid #d6d8db;
            color: #383d41;
        }

        .user-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }

        .user-info h3 {
            color: #007bff;
            margin-bottom: 10px;
        }

        .filter-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .filter-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .filter-group input, .filter-group select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn-filter {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            height: fit-content;
        }

        .btn-filter:hover {
            background: #0056b3;
        }

        .requests-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table-header {
            background: #007bff;
            color: white;
            padding: 15px;
            font-weight: bold;
            text-align: center;
        }

        .table-content {
            max-height: 400px;
            overflow-y: auto;
        }

        .request-item {
            border-bottom: 1px solid #eee;
            padding: 20px;
            transition: background-color 0.3s;
        }

        .request-item:hover {
            background: #f8f9fa;
        }

        .request-item:last-child {
            border-bottom: none;
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .request-id {
            font-weight: bold;
            color: #007bff;
            font-size: 16px;
        }

        .request-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-approved {
            background: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .status-completed {
            background: #cce5ff;
            color: #004085;
        }

        .request-info {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .request-info div {
            color: #666;
        }

        .request-info strong {
            color: #333;
        }

        .tools-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }

        .tools-list h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .tool-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #ddd;
            font-size: 13px;
        }

        .tool-item:last-child {
            border-bottom: none;
        }

        .tool-name {
            flex: 1;
            color: #333;
        }

        .tool-quantity {
            color: #666;
            margin-left: 10px;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        .actions {
            text-align: center;
            margin-top: 20px;
        }

        .btn-new-request {
            padding: 12px 25px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            display: inline-block;
            transition: background-color 0.3s;
            margin-right: 10px;
        }

        .btn-new-request:hover {
            background: #218838;
        }

        .btn-home {
            padding: 12px 25px;
            background: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            display: inline-block;
            transition: background-color 0.3s;
        }

        .btn-home:hover {
            background: #545b62;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 20px;
            }

            .filter-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .request-info {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .request-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ†Ô∏è Tools Track</h1>
            <p>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ (Hybrid Version)</p>
        </div>

        <!-- Connection Status -->
        <div id="connectionStatus" class="connection-status loading">
            üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
        </div>

        <!-- User Info -->
        <div class="user-info">
            <h3>üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
            <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ‡∏Å‡∏°‡∏•‡∏•‡∏≤‡∏® ‡∏ß‡∏¥‡∏ä‡∏±‡∏¢‡πÇ‡∏¢</p>
            <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:</strong> 100007</p>
            <p><strong>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô:</strong> ‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</p>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-row">
                <div class="filter-group">
                    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°:</label>
                    <input type="date" id="startDate">
                </div>
                <div class="filter-group">
                    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î:</label>
                    <input type="date" id="endDate">
                </div>
                <div class="filter-group">
                    <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
                    <select id="statusFilter">
                        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="pending">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                        <option value="approved">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                        <option value="rejected">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</option>
                    </select>
                </div>
                <button class="btn-filter" onclick="filterRequests()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            </div>
        </div>

        <!-- Requests Table -->
        <div class="requests-table">
            <div class="table-header">
                üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠
            </div>
            <div class="table-content" id="requestsContainer">
                <!-- ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
            </div>
        </div>

        <!-- Actions -->
        <div class="actions">
            <a href="tools-request-hybrid.html" class="btn-new-request">
                ‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏´‡∏°‡πà
            </a>
            <a href="index.html" class="btn-home">
                üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
            </a>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js';
        import { 
            getFirestore, 
            collection, 
            getDocs, 
            query, 
            where, 
            orderBy,
            limit
        } from 'https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "your-api-key-here",
            authDomain: "my-database-project.firebaseapp.com", 
            projectId: "my-database-project",
            storageBucket: "my-database-project.appspot.com",
            messagingSenderId: "your-messaging-sender-id",
            appId: "your-app-id-here"
        };

        // Global variables
        let isFirebaseConnected = false;
        let db = null;
        let requestsData = [];
        let filteredRequests = [];

        // Mock Data as fallback
        const mockRequestsData = [
            {
                id: "REQ001",
                employee_id: "100007",
                employee_name: "‡∏Å‡∏°‡∏•‡∏•‡∏≤‡∏® ‡∏ß‡∏¥‡∏ä‡∏±‡∏¢‡πÇ‡∏¢",
                project: "PRANNOK-TADMAI (DH2)",
                created_at: "2024-10-01",
                status: "completed",
                tools: [
                    { tool_name: "‡∏™‡∏ß‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ DEWALT", old_code: "T001", quantity: 1, note: "‡∏á‡∏≤‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á" },
                    { tool_name: "‡∏ö‡∏¥‡∏ï‡∏™‡∏ß‡πà‡∏≤‡∏ô Set 20 ‡∏ä‡∏¥‡πâ‡∏ô", old_code: "T002", quantity: 1, note: "" }
                ],
                approved_by: "‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ A",
                completed_date: "2024-10-02"
            },
            {
                id: "REQ002", 
                employee_id: "100007",
                employee_name: "‡∏Å‡∏°‡∏•‡∏•‡∏≤‡∏® ‡∏ß‡∏¥‡∏ä‡∏±‡∏¢‡πÇ‡∏¢",
                project: "PRANNOK-TADMAI (DH2)",
                created_at: "2024-10-05",
                status: "approved",
                tools: [
                    { tool_name: "‡∏Å‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤", old_code: "T003", quantity: 1, note: "‡∏á‡∏≤‡∏ô‡πÄ‡∏à‡∏≤‡∏∞‡πÑ‡∏°‡πâ" }
                ],
                approved_by: "‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ B",
                approved_date: "2024-10-06"
            },
            {
                id: "REQ003",
                employee_id: "100007", 
                employee_name: "‡∏Å‡∏°‡∏•‡∏•‡∏≤‡∏® ‡∏ß‡∏¥‡∏ä‡∏±‡∏¢‡πÇ‡∏¢",
                project: "PRANNOK-TADMAI (DH2)",
                created_at: "2024-10-08",
                status: "pending",
                tools: [
                    { tool_name: "‡∏•‡∏π‡∏Å‡∏ö‡∏¥‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡πâ‡∏≤‡∏°", old_code: "T004", quantity: 2, note: "" },
                    { tool_name: "‡∏Ñ‡πâ‡∏≠‡∏ô‡∏´‡∏á‡∏≠‡∏ô", old_code: "T005", quantity: 1, note: "‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö" }
                ]
            },
            {
                id: "REQ004",
                employee_id: "100013",
                employee_name: "‡∏ä‡∏±‡∏¢‡∏ä‡∏≤‡∏ç ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå", 
                project: "PRANNOK-TADMAI (DH2)",
                created_at: "2024-10-07",
                status: "rejected",
                tools: [
                    { tool_name: "‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏¢‡∏ß‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", old_code: "T006", quantity: 1, note: "‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏î‡πÑ‡∏°‡πâ" }
                ],
                rejected_by: "‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ A",
                rejected_reason: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô",
                rejected_date: "2024-10-07"
            }
        ];

        // Initialize Firebase and load data
        async function initializeSystem() {
            const statusElement = document.getElementById('connectionStatus');
            
            try {
                // Try to initialize Firebase
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                
                // Test connection by trying to read data
                await loadRequestsFromFirebase();
                
                isFirebaseConnected = true;
                statusElement.className = 'connection-status status-firebase';
                statusElement.innerHTML = 'üî• ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á';
                
                console.log('‚úÖ Firebase ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                console.log('üìã ‡∏Ñ‡∏≥‡∏Ç‡∏≠:', requestsData.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                
            } catch (error) {
                console.warn('‚ö†Ô∏è Firebase ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', error.message);
                isFirebaseConnected = false;
                
                // Use mock data as fallback
                requestsData = [...mockRequestsData];
                
                statusElement.className = 'connection-status status-mock';
                statusElement.innerHTML = 'üì¶ ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á - Firebase ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
                
                console.log('üì¶ ‡πÉ‡∏ä‡πâ Mock Data');
                console.log('üìã ‡∏Ñ‡∏≥‡∏Ç‡∏≠:', requestsData.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
            }
            
            // Set default date range (last 30 days)
            const today = new Date();
            const thirtyDaysAgo = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
            
            document.getElementById('startDate').value = thirtyDaysAgo.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            
            // Display initial data
            filteredRequests = [...requestsData];
            displayRequests(filteredRequests);
        }

        async function loadRequestsFromFirebase() {
            if (!db) throw new Error('Firebase not initialized');
            
            try {
                // Try to get requests for current user (100007)
                const q = query(
                    collection(db, "tool_requests"),
                    where("employee_id", "==", "100007"),
                    orderBy("created_at", "desc"),
                    limit(50)
                );
                
                const querySnapshot = await getDocs(q);
                requestsData = [];
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    requestsData.push({
                        id: doc.id,
                        ...data,
                        created_at: data.created_at?.toDate?.()?.toISOString()?.split('T')[0] || data.created_at
                    });
                });
                
                if (requestsData.length === 0) {
                    console.log('‚ÑπÔ∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏ô Firebase - ‡πÉ‡∏ä‡πâ Mock Data');
                    throw new Error('No requests data found');
                }
                
            } catch (error) {
                console.warn('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase:', error.message);
                throw error;
            }
        }

        function displayRequests(requests) {
            const container = document.getElementById('requestsContainer');
            
            if (requests.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        üì≠ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                    </div>
                `;
                return;
            }

            container.innerHTML = requests.map(request => `
                <div class="request-item">
                    <div class="request-header">
                        <div class="request-id">üìã ${request.id}</div>
                        <div class="request-status ${getStatusClass(request.status)}">
                            ${getStatusText(request.status)}
                        </div>
                    </div>
                    
                    <div class="request-info">
                        <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠:</strong> ${formatDate(request.created_at)}</div>
                        <div><strong>‡∏ú‡∏π‡πâ‡∏Ç‡∏≠:</strong> ${request.employee_name}</div>
                        <div><strong>‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:</strong> ${request.project}</div>
                    </div>

                    ${getStatusDetails(request)}
                    
                    <div class="tools-list">
                        <h4>üîß ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠:</h4>
                        ${request.tools.map(tool => `
                            <div class="tool-item">
                                <span class="tool-name">${tool.old_code || 'N/A'} - ${tool.tool_name}</span>
                                <span class="tool-quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${tool.quantity}</span>
                            </div>
                            ${tool.note ? `<div style="font-size: 12px; color: #666; margin-left: 10px;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${tool.note}</div>` : ''}
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function getStatusClass(status) {
            const statusClasses = {
                'pending': 'status-pending',
                'approved': 'status-approved', 
                'completed': 'status-completed',
                'rejected': 'status-rejected'
            };
            return statusClasses[status] || 'status-pending';
        }

        function getStatusText(status) {
            const statusTexts = {
                'pending': '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
                'approved': '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß',
                'completed': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
                'rejected': '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò'
            };
            return statusTexts[status] || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞';
        }

        function getStatusDetails(request) {
            const dataSource = isFirebaseConnected ? 'üî• Firebase' : 'üì¶ Mock Data';
            
            switch(request.status) {
                case 'approved':
                    return `
                        <div style="background: #d4edda; padding: 10px; border-radius: 5px; margin: 10px 0; font-size: 14px;">
                            ‚úÖ <strong>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÇ‡∏î‡∏¢:</strong> ${request.approved_by || '‡∏£‡∏∞‡∏ö‡∏ö'} 
                            <strong>‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> ${formatDate(request.approved_date) || '-'}
                            <span style="float: right; font-size: 12px; opacity: 0.7;">${dataSource}</span>
                        </div>
                    `;
                case 'completed':
                    return `
                        <div style="background: #cce5ff; padding: 10px; border-radius: 5px; margin: 10px 0; font-size: 14px;">
                            ‚úÖ <strong>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÇ‡∏î‡∏¢:</strong> ${request.approved_by || '‡∏£‡∏∞‡∏ö‡∏ö'}<br>
                            üéâ <strong>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> ${formatDate(request.completed_date) || '-'}
                            <span style="float: right; font-size: 12px; opacity: 0.7;">${dataSource}</span>
                        </div>
                    `;
                case 'rejected':
                    return `
                        <div style="background: #f8d7da; padding: 10px; border-radius: 5px; margin: 10px 0; font-size: 14px;">
                            ‚ùå <strong>‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÇ‡∏î‡∏¢:</strong> ${request.rejected_by || '‡∏£‡∏∞‡∏ö‡∏ö'} 
                            <strong>‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> ${formatDate(request.rejected_date) || '-'}<br>
                            <strong>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</strong> ${request.rejected_reason || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
                            <span style="float: right; font-size: 12px; opacity: 0.7;">${dataSource}</span>
                        </div>
                    `;
                case 'pending':
                default:
                    return `
                        <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0; font-size: 14px;">
                            ‚è≥ <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                            <span style="float: right; font-size: 12px; opacity: 0.7;">${dataSource}</span>
                        </div>
                    `;
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('th-TH', {
                    year: 'numeric',
                    month: 'long', 
                    day: 'numeric'
                });
            } catch (error) {
                return dateString;
            }
        }

        window.filterRequests = function() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const status = document.getElementById('statusFilter').value;

            let filtered = [...requestsData];

            // Filter by date range
            if (startDate) {
                filtered = filtered.filter(req => req.created_at >= startDate);
            }
            if (endDate) {
                filtered = filtered.filter(req => req.created_at <= endDate);
            }

            // Filter by status
            if (status) {
                filtered = filtered.filter(req => req.status === status);
            }

            filteredRequests = filtered;
            displayRequests(filtered);
            
            const dataSource = isFirebaseConnected ? 'Firebase' : 'Mock Data';
            console.log(`üîç ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ${dataSource}:`, filtered.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeSystem);
    </script>
</body>
</html>